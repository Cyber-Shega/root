"use strict";var xssScanEnabled=!0,alreadyProcessedFunctions=[];function SearchElement(description,type,string){this.description=description,this.type=type,this.string=string}var searchElements=[new SearchElement("form","string","<form"),new SearchElement("url","string","http://"),new SearchElement("url","string","https://"),new SearchElement("web socket","string","ws://"),new SearchElement("web socket","string","wss://"),new SearchElement("post request","string",'"POST"'),new SearchElement("get request","string",'"GET"'),new SearchElement("post request","string","'POST"),new SearchElement("get request","string","'GET'"),new SearchElement("ajax request","string",".ajax"),new SearchElement("post request","string","$.post"),new SearchElement("get request","string","$.get"),new SearchElement("query","string","query"),new SearchElement("api call","string","/api"),new SearchElement("php file","string",".php"),new SearchElement("asp file","string",".asp"),new SearchElement("json file","string",".json"),new SearchElement("mailto protocol","string","mailto:"),new SearchElement("something on mysql","string","mysql"),new SearchElement("something on email","string",'"email"'),new SearchElement("something on username","string",'"username"'),new SearchElement("something on username","string",'"user"'),new SearchElement("something on password","string",'"password"'),new SearchElement("something on password","string",'"pass"'),new SearchElement("something on password","string",'"psw"'),new SearchElement("something on password","string",'"pwd"')];function getAllUrlParams(url){var queryString=url?url.split("?")[1]:window.location.search.slice(1),obj={};if(queryString)for(var arr=(queryString=queryString.split("#")[0]).split("&"),i=0;i<arr.length;i++){var a=arr[i].split("="),paramName=a[0],paramValue=void 0===a[1]||a[1];if(paramName=paramName.toLowerCase(),"string"==typeof paramValue&&(paramValue=paramValue.toLowerCase()),paramName.match(/\[(\d+)?\]$/)){var key=paramName.replace(/\[(\d+)?\]/,"");if(obj[key]||(obj[key]=[]),paramName.match(/\[\d+\]$/)){var index=/\[(\d+)\]/.exec(paramName)[1];obj[key][index]=paramValue}else obj[key].push(paramValue)}else obj[paramName]?obj[paramName]&&"string"==typeof obj[paramName]?(obj[paramName]=[obj[paramName]],obj[paramName].push(paramValue)):obj[paramName].push(paramValue):obj[paramName]=paramValue}return obj}function getjQueryEventHandlers(element,eventns){const $=window.jQuery,i=(eventns||"").indexOf("."),event=i>-1?eventns.substr(0,i):eventns,namespace=i>-1?eventns.substr(i+1):void 0,handlers=Object.create(null);if(!(element=$(element)).length)return handlers;const listeners=$._data(element.get(0),"events")||handlers,events=event?[event]:Object.keys(listeners);if(!eventns)return listeners;function getHandlers(e){const type=this.toString(),eNamespace=e.namespace||e.data&&e.data.handler;(event===type&&!namespace||eNamespace===namespace&&!event||eNamespace===namespace&&event===type)&&(handlers[type]=handlers[type]||[],handlers[type].push(e))}return events.forEach(type=>{(listeners[type]||[]).forEach(getHandlers,type)}),handlers}function listAllEventListeners(){const allElements=Array.prototype.slice.call(document.querySelectorAll("*"));allElements.push(document),allElements.push(window);const types=[];for(let ev in window)/^on/.test(ev)&&(types[types.length]=ev);let elements=[];for(let i=0;i<allElements.length;i++){const currentElement=allElements[i];for(let j=0;j<types.length;j++)"function"==typeof currentElement[types[j]]&&elements.push(currentElement[types[j]])}return elements}function regexIndexOf(string,regex,startpos){var indexOf=string.substring(startpos||0).search(regex);return indexOf>=0?indexOf+(startpos||0):indexOf}function regexAllIndexOf(string,regex,startpos){regex=regex.global?regex:new RegExp(regex.source,"g"+(regex.ignoreCase?"i":"")+(regex.multiLine?"m":"")),void 0===startpos?startpos=string.length:startpos<0&&(startpos=0);for(var stringToWorkWith=string.substring(0,startpos+1),lastIndexOf=-1,nextStop=0;null!=(result=regex.exec(stringToWorkWith));)lastIndexOf=result.index,regex.lastIndex=++nextStop,indexes.push(lastIndexOf);return lastIndexOf}function getAllIndexes(arr,val){const indexes=[];let i=-1;for(;-1!==(i=arr.indexOf(val,i+1));)indexes.push(i);return indexes}function searchInside(functionToString,object,objKeys,o,level){void 0===objKeys[o]&&(objKeys[o]=""),void 0===object[objKeys[o]]&&(object[objKeys[o]]=""),searchElements.forEach(v=>{if("string"===v.type){const index=getAllIndexes(functionToString,v.string);index.forEach(ind=>{console.log("DDDX "+v.description,level,objKeys[o],object[objKeys[o]],functionToString.substr(ind-15,60))})}else if("regEx"===v.type){const index=regexAllIndexOf(functionToString,v.string,0);index.forEach(ind=>{console.log("DDDX regEx "+v.description,level,objKeys[o],object[objKeys[o]],functionToString.substr(ind-15,60))})}})}function recursiveEnumerate(object,level){level++;const objKeys=Object.keys(object);for(let o=0;o<objKeys.length;o++)if(null!==object[objKeys[o]]&&("function"==typeof object[objKeys[o]]||"object"==typeof object[objKeys[o]])&&"recursiveEnumerate"!==objKeys[o]&&"alreadyProcessedFunctions"!==objKeys[o])try{const functionToString=object[objKeys[o]].toString().replace(/(\r\n|\n|\r)/gm,"").replace(/\s\s+/g," ");-1===alreadyProcessedFunctions.indexOf(functionToString)&&(searchInside(functionToString,object,objKeys,o,level),-1===functionToString.indexOf("[object Object]")&&alreadyProcessedFunctions.push(functionToString),"set"!==objKeys[o]&&"push"!==objKeys[o]&&recursiveEnumerate(object[objKeys[o]],level))}catch(e){}}function searchJqueryListeners(){var jQueryListeners=[];$("*").each((i,v)=>{const elementListeners=getjQueryEventHandlers(v);Object.keys(elementListeners).length>0&&jQueryListeners.push(elementListeners)}),recursiveEnumerate(jQueryListeners,0)}async function testUrlParamFiltering(){const paramsEntitiesTemp=Object.entries(getAllUrlParams(document.location.href));for(let i=0;i<paramsEntitiesTemp.length;i++){const paramsEntities=Object.entries(getAllUrlParams(document.location.href)),v=paramsEntities[i];v[1]=v[1]+'"><script>alert("PARAMETRO_VULNERABILE_XSS")<\/script><div ';const mod=paramsEntities.map(v=>v[0]+"="+v[1]),newUrl=document.location.origin+document.location.pathname+"?"+mod.join("&");await $.get(newUrl).done((function(data){-1!==data.indexOf("PARAMETRO_VULNERABILE_XSS")&&(console.log('Parametro "'+v[0]+'" Vulnerabile ad attachi XSS'),console.log("url",newUrl))}))}}new SearchElement("REGEX email address","regEx",/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),new SearchElement("REGEX API Key","regEx",/^[a-f0-9]{32}$/),console.log("Created by Davide Cavallini"),console.log("Linkedin: https://www.linkedin.com/in/davidecavallini/"),console.log("----------------------------------------------------------"),console.log("\n"),recursiveEnumerate(window,0),recursiveEnumerate(listAllEventListeners(),0),searchInside(document.body.innerHTML.replace(/(\r\n|\n|\r)/gm,"").replace(/\s\s+/g," "),document.body,["BODY"],0,0),recursiveEnumerate(getjQueryEventHandlers(document),0),searchJqueryListeners(),console.log("Contenuto cookie",document.cookie),!0===xssScanEnabled&&testUrlParamFiltering(),console.log("\n"),console.log("----------------------------------------------------------"),console.log("Created by Davide Cavallini"),console.log("Linkedin: https://www.linkedin.com/in/davidecavallini/");